name: Release Notification To Slack

on:
  workflow_dispatch:

jobs:
  get_release_notes:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
      - name: Get latest release notes
        id: get_release_notes
        run: |
          release_info=$(curl -H "Accept: application/vnd.github.v3+json" https://api.github.com/repos/jaehwaa/github-actions/releases/latest)
          description=$(echo $release_info | jq -r '.body')
          release_notes=$(echo -n $description | sed 's/\r$//')
          
          echo "release_notes=$release_notes" >> $GITHUB_OUTPUT

      - name: Slack Notification
        run: |
          MSG="{ \"text\": '${{ steps.get_release_notes.outputs.release_notes }}' }"
          echo $MSG
          curl -X POST -H 'Content-type: application/json' --data "${MSG}" "${{ secrets.slack_webhook_url }}"